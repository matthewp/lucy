<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lucy | A DSL for Finite State Machines</title>
<link rel="stylesheet" href="styles/main.css">
<link rel="stylesheet" href="styles/dracula-prism.css">

<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/site.webmanifest">

<body class="home">

<header class="content container">
  <h1>üßõüèª‚Äç‚ôÄÔ∏è Lucy</h1>
</header>

<nav class="container">
  <ul>
    <li><a href="./language-overview.html">Language overview</a></li>
    <li><a href="./babel-plugin-xstate.html">Babel plugin</a></li>
    <li><a href="https://github.com/matthewp/lucy">GitHub</a></li>
  </ul>
</nav>

<main>
  <div class="content container">
    <p>A DSL for <a href="https://brilliant.org/wiki/finite-state-machines/">finite state machines</a> and <a href="https://statecharts.github.io/">statecharts</a>. Declare states and transitions in a format anyone can understand. Compiles to your FSM runtime's native format (currently XState).</p>
<p>A simple toggle machine:</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">active</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  toggle <span class="token operator">=</span><span class="token operator">></span> inactive</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">inactive</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  toggle <span class="token operator">=</span><span class="token operator">></span> active</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Usually Lucy is used as an embedded language, such as in JavaScript. Lucy works wonderfully with <a href="https://xstate.js.org">XState</a>. Here is a simple counter machine:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Fragment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useMachine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@xstate/react'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> machine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@lucy/xstate'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="token keyword">const</span> counterMachine <span class="token operator">=</span> machine<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token lucy language-lucy"><br><span class="highlight-line">  <span class="token keyword">context</span> <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"> </span><br><span class="highlight-line">  <span class="token keyword">action</span> increment <span class="token operator">=</span> <span class="token function">assign</span> count <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line">  <span class="token keyword">action</span> decrement <span class="token operator">=</span> <span class="token function">assign</span> count <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> count <span class="token operator">-</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">guard</span> isNotMax <span class="token operator">=</span> <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> count <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line">  <span class="token keyword">guard</span> isNotMin <span class="token operator">=</span> <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> count <span class="token operator">></span> <span class="token number">0</span><span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">active</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    inc <span class="token operator">=</span><span class="token operator">></span> isNotMax <span class="token operator">=</span><span class="token operator">></span> increment</span><br><span class="highlight-line">    dec <span class="token operator">=</span><span class="token operator">></span> isNotMin <span class="token operator">=</span><span class="token operator">></span> decrement</span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>current<span class="token punctuation">,</span> send<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useMachine</span><span class="token punctuation">(</span>counterMachine<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> current<span class="token punctuation">.</span>context<span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>Fragment<span class="token operator">></span></span><br><span class="highlight-line">      Count<span class="token punctuation">:</span> <span class="token operator">&lt;</span>strong<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'inc'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span> Increment<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'dec'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">-</span> Decrement<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre>
<h2 id="why-a-dsl"><a class="heading-anchor" href="#why-a-dsl">#</a> Why a DSL?</h2>
<p>Typically we write programs (and components) as a series of mutable variables that are modified over time. Even with a more functional <em>looking</em> approach, ultimately it comes down to imperative programming.</p>
<p>This makes it impossible to understand how the application really <em>works</em> without understanding all of the code within the program.</p>
<p>Finite state machines (and <a href="https://statecharts.github.io/">startcharts</a>) allow state to be modeled declaratively. This leads to more readable code, and eliminates the possibility of your application following into a bad state.</p>
<p><strong>Lucy</strong> is a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">domain-specific language (DSL)</a> for state machines. In most FSM libraries you have to model your machine with configuration that difficult to read (config soup). Lucy fixes this with a simplified syntax that includes all of the concepts of statecharts.</p>
<p>Goals are to:</p>
<ul>
<li>Allow non-engineers to understand, and even <em>author</em> an applications state.</li>
<li>Provide compile time guarantees that a component's states are all valid.</li>
<li>Take the lessons from the declarative UI revolution and bring them to application state.</li>
<li>Make writing application behaviors fun.</li>
</ul>
<h2 id="quick-start"><a class="heading-anchor" href="#quick-start">#</a> Quick start</h2>
<p>First install <code>@lucy/xstate</code> and <code>xstate</code>:</p>
<p>With npm:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span> @lucy/xstate xstate</span></code></pre>
<p>With yarn:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">yarn</span> <span class="token function">add</span> @lucy/xstate xstate</span></code></pre>
<p>The toggle demo from <a href="https://xstate.js.org/docs/#super-quick-start">XState's quick start</a> looks like this:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Machine<span class="token punctuation">,</span> interpret <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'xstate'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> machine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@lucy/xstate'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// Stateless machine definition</span></span><br><span class="highlight-line"><span class="token comment">// machine.transition(...) is a pure function used by the interpreter.</span></span><br><span class="token keyword">const</span> toggleMachine <span class="token operator">=</span> machine<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token lucy language-lucy"><br><span class="highlight-line">  <span class="token keyword">state</span> <span class="token class-name">active</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    toggle <span class="token operator">=</span><span class="token operator">></span> inactive</span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">inactive</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    toggle <span class="token operator">=</span><span class="token operator">></span> active</span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// Machine instance with internal state</span></span><br><span class="highlight-line"><span class="token keyword">const</span> toggleService <span class="token operator">=</span> <span class="token function">interpret</span><span class="token punctuation">(</span>toggleMachine<span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">.</span><span class="token function">onTransition</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// => 'inactive'</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">toggleService<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'toggle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// => 'active'</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">toggleService<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'toggle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// => 'inactive'</span></span></code></pre>
<h2 id="license"><a class="heading-anchor" href="#license">#</a> License</h2>
<p><a href="https://opensource.org/licenses/BSD-2-Clause">BSD 2 Clause</a></p>

  </div>
</main>

<footer>
<div class='outer-scratch'>
  <div class="inner-scratch">
    <div class="footer-content">
      <p>Made with üéÉ by <a href="https://twitter.com/matthewcp">@matthewcp</a></p>
    </div>
  </div>
</div>
  
</footer>