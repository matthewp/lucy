
<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Language Overview</title>
<link rel="stylesheet" href="styles/main.css">
<link rel="stylesheet" href="styles/content.css">
<link rel="stylesheet" href="styles/dracula-prism.css">

<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/site.webmanifest">

<body class="no-title">

<nav class="container">
  <ul>
    <li><a href="./">Lucy</a></li><li class="active">
      
        
          Language Overview
        
      
    </li><li>
      
      <a href="/babel-plugin-xstate.html">
        
          Babel Plugin XState
        
      </a>
      
    </li><li>
      
      <a href="/prism-plugin.html">
        
          Prism Plugin
        
      </a>
      
    </li><li>
      
      <a href="/vscode-lucy.html">
        
          VSCode Lucy
        
      </a>
      
    </li><li><a href="https://github.com/matthewp/lucy">GitHub</a></li>
  </ul>
</nav>

<main>
  <div class="content container">
    <p>This page gives an overview of the language. Once you understand the few concepts on this page you'll be able to build any type of machine needed.</p>
<p><strong>Table of Contents</strong></p>
<p><ul class="toc">
<li><a href="#state">State</a></li>
<li><a href="#transitions">Transitions</a>
<ul>
<li><a href="#immediate-transitions">Immediate transitions</a></li>
</ul>
</li>
<li><a href="#context">Context</a></li>
<li><a href="#actions">Actions</a>
<ul>
<li><a href="#assign">Assign</a></li>
</ul>
</li>
<li><a href="#guards">Guards</a></li>
<li><a href="#comments">Comments</a></li>
</ul>
</p>
<h1 id="state"><a class="heading-anchor" href="#state">#</a> State</h1>
<p>A Finite State Machine is made up of states that the machine can transition between. This classic stop light example shows the different states of this machine:</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">red</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">green</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">yellow</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Adding transitions allows us to now change states.</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">red</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  next <span class="token operator">=</span><span class="token operator">></span> green</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">green</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  next <span class="token operator">=</span><span class="token operator">></span> yellow</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">yellow</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  next <span class="token operator">=</span><span class="token operator">></span> red</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>States have 2 important modifiers, <code>initial</code> and <code>final</code>. The <strong>initial</strong> state is the state the application will be in when the machine starts. We can update our stoplight machine to start off in the red light:</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">red</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  next <span class="token operator">=</span><span class="token operator">></span> green</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">green</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  next <span class="token operator">=</span><span class="token operator">></span> yellow</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">yellow</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  next <span class="token operator">=</span><span class="token operator">></span> red</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>If no <strong>initial</strong> state is provided the runtime will usually use the first state declared. Defining your initial state is still good practice for readability.</p>
<p>Conversely a machine can have a <strong>final</strong> state, which is a state in which the machine cannot transition out of.</p>
<p>Not all machines need a final state. The stoplight example does not, because we want the stoplight to continue indefinitely. Machines with final states are usually those with a limited lifespan.</p>
<p>This example is a washing machine, which starts, washes, and finishes.</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">action</span> beep</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">off</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  start <span class="token operator">=</span><span class="token operator">></span> wash</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">wash</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  done <span class="token operator">=</span><span class="token operator">></span> rinse</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">rinse</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  done <span class="token operator">=</span><span class="token operator">></span> dry</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">dry</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  done <span class="token operator">=</span><span class="token operator">></span> clean</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">final</span> <span class="token keyword">state</span> <span class="token class-name">clean</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> beep</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<h1 id="transitions"><a class="heading-anchor" href="#transitions">#</a> Transitions</h1>
<p>In Lucy you can define a transition between states. The fat-arrow (<code>=&gt;</code>) symbol is used to pipe from one step to the other. A transition can contain:</p>
<ul>
<li><strong>events</strong>: Sent from outside of the machine that start a transition.</li>
<li><strong>guards</strong>: A way to stop a transition from occuring.</li>
<li><strong>actions</strong>: Side-effects that run during the transition.</li>
<li><strong>states</strong>: The desired state at the end of the transition.</li>
</ul>
<p>The ordering of these steps is determined by the runtime, but most of the time the ordering should be: <code>event =&gt; action or guard =&gt; state</code>.</p>
<p>Many transitions don't contain actions or guards, and are simply a mapping of events to states. For example this toggle machine:</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">disabled</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  toggle <span class="token operator">=</span><span class="token operator">></span> enabled</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">enabled</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  toggle <span class="token operator">=</span><span class="token operator">></span> disable</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Here the event <code>toggle</code> is send outside of the machine and immediately transitions to the next state (either <code>enabled</code> or <code>disabled</code>).</p>
<h2 id="immediate-transitions"><a class="heading-anchor" href="#immediate-transitions">#</a> Immediate transitions</h2>
<p>If no <strong>event</strong> is provided for a transition it will occur immediately when the state is entered. Here's a machine for a daily schedule where breakfast is skipped.</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">sleep</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  wake <span class="token operator">=</span><span class="token operator">></span> breakfast</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">breakfast</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> working</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">working</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">// More stuff here...</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>In the above example the <code>breakfast</code> state immediate transitions to <code>working</code>.</p>
<p>Immediate transitions are good for modeling states that only exist for side-effects, such as assigning to the context. The following machine is used to display an error message when a form contains an error, and to clear the error when not.</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">action</span> clearError</span><br><span class="highlight-line"><span class="token keyword">action</span> updateSubmissionError</span><br><span class="highlight-line"><span class="token keyword">action</span> thankUser</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">guard</span> hasError</span><br><span class="highlight-line"><span class="token keyword">guard</span> canSubmit</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">form</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  keyup <span class="token operator">=</span><span class="token operator">></span> input</span><br><span class="highlight-line">  submit <span class="token operator">=</span><span class="token operator">></span> complete</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">input</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> hasError <span class="token operator">=</span><span class="token operator">></span> clearError <span class="token operator">=</span><span class="token operator">></span> form</span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> form</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">validate</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> canSubmit <span class="token operator">=</span><span class="token operator">></span> complete</span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> updateSubmissionError <span class="token operator">=</span><span class="token operator">></span> form</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">final</span> <span class="token keyword">state</span> <span class="token class-name">complete</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> thankUser</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>This machine allows you to fill out a login form. When the user <code>submit</code>s the form it goes into a <code>validate</code> state, which checks if it can be submitted (if there are no errors). If that condition does not pass it moves to the next <strong>immediate transition</strong> which updates the error message.</p>
<p>Whenever the user starts typing again the error message is cleared out and isn't shown until the form is submitted again.</p>
<p>When the user submits the form and the <code>canSubmit</code> guard passes, it moves to the <code>complete</code> state where it immediately runs the <code>thankUser</code> action.</p>
<h1 id="context"><a class="heading-anchor" href="#context">#</a> Context</h1>
<p>Finite state machines allow modeling known states, but real applications contain data such as from user input that must be placed outside of the states. Statecharts include <a href="https://en.wikipedia.org/wiki/UML_state_machine#Extended_states">extended state</a> as an answer for this.</p>
<p>In Lucy extended state is modeled as <strong>context</strong>. An initial context value can be declared for a machine, and assignment actions can modify the context.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> machine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@lucy/xstate'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="token keyword">const</span> nameMachine <span class="token operator">=</span> machine<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token lucy language-lucy"><br><span class="highlight-line">  <span class="token keyword">context</span> <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'world'</span> <span class="token punctuation">}</span> <span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">state</span> <span class="token class-name">form</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// Transitions here might modify the context  </span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<h1 id="actions"><a class="heading-anchor" href="#actions">#</a> Actions</h1>
<p>An <strong>action</strong> is a side-effect taken within a transition. The following is an action that logs whenever the <code>increment</code> event is sent through the machine:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> machine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@lucy/xstate'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="token keyword">const</span> counterMachine <span class="token operator">=</span> machine<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token lucy language-lucy"><br><span class="highlight-line">  <span class="token keyword">action</span> logIncrement <span class="token operator">=</span> <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Incremented'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">counter</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    inc <span class="token operator">=</span><span class="token operator">></span> logIncrement</span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<h2 id="assign"><a class="heading-anchor" href="#assign">#</a> Assign</h2>
<p>The <strong>assign</strong> keyword is used within an action to assign a <strong>context</strong> value as part of an action. This is useful to keep <a href="https://en.wikipedia.org/wiki/UML_state_machine#Extended_states">extended state</a>.</p>
<p>The above counter machine is missing keeping the count. The following adds an <code>incrementCount</code> action with an assignment.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> machine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@lucy/xstate'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="token keyword">const</span> counterMachine <span class="token operator">=</span> machine<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token lucy language-lucy"><br><span class="highlight-line">  <span class="token keyword">context</span> <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">action</span> logIncrement <span class="token operator">=</span> <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Incremented'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">action</span> incrementCount <span class="token operator">=</span> <span class="token function">assign</span> count <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">counter</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    inc <span class="token operator">=</span><span class="token operator">></span> logIncrement <span class="token operator">=</span><span class="token operator">></span> incrementCount</span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>Assign takes the signature of <code>assign prop ${fn}</code> where <code>prop</code> is a property on the <strong>context</strong> object, and <code>fn</code> is a function that returns a new value for <code>prop</code>.</p>
<h1 id="guards"><a class="heading-anchor" href="#guards">#</a> Guards</h1>
<p><strong>Guards</strong> control the ability to exit or enter a state. In the following example we only want to enter the <code>submit</code> state if the machine state is valid.</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">guard</span> invalidPassword</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">form</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  done <span class="token operator">=</span><span class="token operator">></span> submit</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">final</span> <span class="token keyword">state</span> <span class="token class-name">submit</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token operator">=</span><span class="token operator">></span> invalidPassword <span class="token operator">=</span><span class="token operator">></span> form</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>We could also model this as part of the form transition. When the <code>done</code> event fires, check for the passwords validity before proceeding:</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token keyword">guard</span> validPassword</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">form</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  done <span class="token operator">=</span><span class="token operator">></span> validPassword <span class="token operator">=</span><span class="token operator">></span> submit</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">final</span> <span class="token keyword">state</span> <span class="token class-name">submit</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">// We are all done</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<h1 id="comments"><a class="heading-anchor" href="#comments">#</a> Comments</h1>
<p>Comments can be added using the <code>//</code> syntax, as in C-like languages:</p>
<pre class="language-lucy"><code class="language-lucy"><span class="highlight-line"><span class="token comment">// Wait for the race to start</span></span><br><span class="highlight-line"><span class="token keyword">initial</span> <span class="token keyword">state</span> <span class="token class-name">waiting</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">// When the gun goes off, start running</span></span><br><span class="highlight-line">  start <span class="token operator">=</span><span class="token operator">></span> running</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">state</span> <span class="token class-name">running</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">// When the race is finished, rest</span></span><br><span class="highlight-line">  finish <span class="token operator">=</span><span class="token operator">></span> rest</span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// When in the rest state the race is over</span></span><br><span class="highlight-line"><span class="token keyword">final</span> <span class="token keyword">state</span> <span class="token class-name">rest</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>

  </div>
</main>

<footer></footer>